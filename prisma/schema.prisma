generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  name          String?
  email         String    @unique
  password      String?   // Make password optional for Google auth
  googleId      String?   // Store Google ID when they authenticate with Google
  image         String?   // Profile image from Google
  coins         Int       @default(0)  // Add this field
  payments      Payment[]
  subjectiveResults subjectiveresult[] 
  mcqResults    mcqresult[]  // Add this relation
  mindmaps      mindmap[] // Add this relation
  createdAt     DateTime? @default(now()) // Make optional
  updatedAt     DateTime? @default(now()) // Make optional
}

model Payment {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  paymentId      String   @unique
  userId         String   @db.ObjectId
  user           User     @relation(fields: [userId], references: [id])
  amount         Int
  currency       String
  paymentMethod  String
  status         String
  contactNumber  String?
  createdAt      DateTime @default(now())
  transactionId  String?
  orderId        String?
}

model subjectiveresult {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @db.ObjectId
  user        User     @relation(fields: [userId], references: [id])
  title       String?  // Optional title for the quiz/study session
  pdfName     String?  // Name of the uploaded PDF
  pdfUrl      String   // S3 URL of the uploaded PDF
  questions   Json     // Store the questions and answers as JSON
  createdAt   DateTime @default(now())
}

model mcqresult {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  userId          String   @db.ObjectId
  user            User     @relation(fields: [userId], references: [id])
  title           String?  // Optional title for the quiz
  totalQuestions  Int
  correctAnswers  Int
  incorrectAnswers Int
  score           Float
  timeTaken       Int      // in seconds
  pdfName         String?  // Name of the uploaded PDF
  pdfUrl          String   // S3 URL of the uploaded PDF
  questions       Json     // Store the full MCQ data including questions, options, answers
  createdAt       DateTime @default(now())
}

model mindmap {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @db.ObjectId
  user        User     @relation(fields: [userId], references: [id])
  title       String?  // Optional title for the mindmap
  pdfName     String?  // Name of the uploaded PDF
  pdfUrl      String   // S3 URL of the uploaded PDF
  mindmapUrl  String   // URL to the generated mindmap JSON
  createdAt   DateTime @default(now())
}
